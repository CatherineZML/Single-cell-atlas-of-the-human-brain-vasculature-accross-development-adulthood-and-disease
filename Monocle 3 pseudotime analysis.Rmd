---
title: "Figure 3 - Monocle 3 pseudotime analysis"
author: "Moheb Ghobrial"
output: html_notebook
---


```{r}
#Source http://htmlpreview.github.io/?https://github.com/satijalab/seurat-wrappers/blob/master/docs/monocle3.html

#load libraries 
library(monocle3)
library(Seurat)
library(SeuratData)
library(SeuratWrappers)
library(ggplot2)
library(patchwork)
library(magrittr)
library(ggbeeswarm)

# Load the seurat object
seurat <- readRDS(file = "seurat.rds")

# convert the seurat object to cds object 
cds <- as.cell_data_set(seurat)
cds <- cluster_cells(cds)
cds <- reduce_dimension(cds, reduction_method="tSNE")


# To transfer the cell embeddings from the seurat object to the cds object:
cds@int_colData@listData[["reducedDims"]][["tSNE"]] <-seurat@reductions[["TSNE"]]@cell.embeddings
cds@int_colData@listData[["reducedDims"]][["UMAP"]] <- seurat@reductions[["UMAP"]]@cell.embeddings


#choose the root point
cds <- learn_graph(cds)
cds <- order_cells(cds)

#plot the pseudotime
plot_cells(cds, color_cells_by = "pseudotime", label_cell_groups = FALSE, label_leaves = FALSE, 
 label_branch_points = FALSE, graph_label_size = 6, group_label_size = 6,cell_size = 1.5)


#plot a ggplot to ordercells 
pdata_cds <- pData(cds)
pdata_cds$pseudotime_monocle3 <- monocle3::pseudotime(cds)
ggplot(as.data.frame(pdata_cds), 
       aes(x = pseudotime_monocle3, 
           y = factor(RPCA_clusters, level = level_order), colour = RPCA_clusters)) +
    geom_quasirandom(groupOnX = FALSE) +
    scale_color_manual(values = my_color) + theme_classic() +
    xlab("monocle3 pseudotime") + ylab("Timepoint") +
    ggtitle("Cells ordered by monocle3 pseudotime")
dev.off()



```
